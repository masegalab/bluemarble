<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Changing Earth</title>

    <link href="http://masegalab.github.io/bluemarble/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://masegalab.github.io/bluemarble/assets/css/main.css" rel="stylesheet">
    <script src="http://masegalab.github.io/bluemarble/assets/js/d3.min.js"></script>

  </head>
  <body>






    <div>
        <div id="canvas-image"></div>

        <div id="annotation">

            <div class="title">
                <span class='title-sup'>changing</span>
                <span class="title-sub">earth</span>
                <p class="small"><a href="http://www.masega.co">by masega</a></p>
            </div>

            <div class="lead">
                <p>One year in Earth's life.</p>

                <p class="small">Get the code on <a href="">GitHub</a>. Images from NASA <a href="http://visibleearth.nasa.gov/view_cat.php?categoryID=1484">Visible Earth.</a></p>
            </div>

            <div id="controls">
                <p><span id='control-label'>play</span> <span class="glyphicon glyphicon-play" id='control-button'></span></p>

                <p><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://masegalab.github.io/bluemarble/">Tweet</a></p>
            </div>
        </div>
    </div>

    <script>
        var images = [
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200402.jpg', img: null, month:  0, label: 'FEBRUARY 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200403.jpg', img: null, month:  1, label: 'MARCH 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200404.jpg', img: null, month:  2, label: 'APRIL 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200405.jpg', img: null, month:  3, label: 'MAY 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200406.jpg', img: null, month:  4, label: 'JUNE 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200407.jpg', img: null, month:  5, label: 'JULY 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200408.jpg', img: null, month:  6, label: 'AUGUST 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200409.jpg', img: null, month:  7, label: 'SEPTEMBER 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200410.jpg', img: null, month:  8, label: 'OCTOBER 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200411.jpg', img: null, month:  9, label: 'NOVEMBER 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200412.jpg', img: null, month: 10, label: 'DECEMBER 2004'},
            {ready: false, url: 'http://masegalab.github.io/bluemarble/assets/images/200401.jpg', img: null, month: 11, label: 'JANUARY 2004'}
        ];

        // Load the images
        images.forEach(function(image) {
            image.img = new Image();
            image.img.src = image.url;
            image.img.onload = function() {
                image.ready = true;
                loadImages();
            }
        });

        var width  = parseInt(d3.select('#canvas-image').style('width'), 0),
            height = width / 2;

        function loadImages() {

            // All the images are loaded
            if (images.every(function(d) { return d.ready; })) {

                // Change the background color
                d3.select('body').transition().duration(1000)
                    .style('background-color', '#f4f4f4');

                var canvas = d3.select('#canvas-image').selectAll('canvas')
                    .data(images, function(d) { return d.month; });

                canvas.enter().append('canvas')
                    .attr('width',  width)
                    .attr('height', height)
                    .attr('class', 'earth-image');

                canvas.call(function(selection) {
                    selection.each(function(image, index) {

                        var context = d3.select(this).node().getContext('2d');

                        // Draw the canvas image
                        context.drawImage(image.img, 0, 0, width, height);
                        context.setFillColor('#bababa');
                        context.font = '12pt Arial';
                        context.fillText(image.label, 40, 30);
                    });
                });
            }
        }

        var imageIndex = 0,
            running = false,
            currentTimeout;

        function animateImages() {

            var canvas = d3.select('#canvas-image').selectAll('canvas');

            canvas.transition().duration(2000)
                .style('opacity', function(d) { return +(d.month <= imageIndex); });

            imageIndex = (imageIndex + 1) % images.length;

            d3.select('#month-label')
                .html(images[imageIndex].label);

            if (running) {
                currentTimeout = setTimeout(animateImages, 2000);
            }
        }

        d3.select('#controls').on('click', function() {

            running = !running;

            var label = running ? 'pause' : 'play';

            d3.select('#control-label').html(function() {
                return running ? 'pause' : 'play';
            });

            d3.select('#control-button')
                .classed('glyphicon-play', !running)
                .classed('glyphicon-pause', running);

            if (running) {
                animateImages();
            } else {
                clearTimeout(currentTimeout);
            }

        });


    </script>

    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </body>
</html>